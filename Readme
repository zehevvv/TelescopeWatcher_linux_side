# TelescopeWatcher - Raspberry Pi Network Setup

## Overview
- Device: Raspberry Pi 5 running Linux (Raspberry Pi OS Lite)
- Task: Stream camera data using MJPEG-streamer
- Challenge: Trigger MJPEG-streamer remotely from Android or PC without a router or external Wi-Fi
- Solution: Two options to connect a PC/Android to the Raspberry Pi

---

## Choose Your Connection Method

| | Option A: Wi-Fi Hotspot | Option B: Ethernet Direct Connection |
|---|---|---|
| **How it works** | RPi creates a Wi-Fi network, PC/Android connects to it wirelessly | RPi acts as router on Ethernet cable, Wi-Fi stays normal |
| **Wi-Fi on RPi** | ❌ No normal Wi-Fi (used for hotspot) | ✅ Normal Wi-Fi works |
| **PC connects via** | Wi-Fi | Ethernet cable |
| **RPi IP address** | 192.168.4.1 | 192.168.4.1 |
| **Best for** | No router available, mobile use | Stationary setup, need internet on RPi |

---

## Option A: Wi-Fi Hotspot

This turns the Raspberry Pi into a Wi-Fi Access Point. The PC/Android connects to the RPi's Wi-Fi network.
**Note:** The RPi will NOT be connected to any other Wi-Fi network in this mode.

### Step 1: Stop Wi-Fi from connecting normally

```bash
sudo nmcli device disconnect wlan0
```

Edit the config file so Wi-Fi doesn't connect automatically:

```bash
sudo nano /etc/NetworkManager/NetworkManager.conf
```

Add this at the end:

```
[keyfile]
unmanaged-devices=interface-name:wlan0
```

Restart NetworkManager:

```bash
sudo systemctl restart NetworkManager
```

### Step 2: Install required packages

```bash
sudo apt-get update
sudo apt install hostapd dnsmasq
```

### Step 3: Configure hostapd

Open config file:

```bash
sudo nano /etc/hostapd/hostapd.conf
```

Paste the following:

```
interface=wlan0
driver=nl80211
ssid=RaspberryPiCam
hw_mode=g
channel=6
auth_algs=1
wmm_enabled=0
```

### Step 4: Tell hostapd to use that config file

```bash
sudo nano /etc/default/hostapd
```

Find the line that starts with `#DAEMON_CONF=""` and change it to:

```
DAEMON_CONF="/etc/hostapd/hostapd.conf"
```

### Step 5: Enable and start hostapd

```bash
sudo systemctl unmask hostapd
sudo systemctl enable hostapd
sudo systemctl restart hostapd
```

### Step 6: Configure dnsmasq for DHCP

Create a custom config file:

```bash
sudo nano /etc/dnsmasq.d/raspi-hotspot.conf
```

Paste this:

```
interface=wlan0
dhcp-range=192.168.4.2,192.168.4.20,255.255.255.0,24h
address=/gateway/192.168.4.1
```

Disable the default config (optional but recommended):

```bash
sudo mv /etc/dnsmasq.conf /etc/dnsmasq.conf.backup
```

### Step 7: Restart dnsmasq

```bash
sudo systemctl enable dnsmasq
sudo systemctl restart dnsmasq
```

You can check if it's working with:

```bash
journalctl -u dnsmasq
```

### Step 8: Assign static IP to wlan0

```bash
sudo ip addr add 192.168.4.1/24 dev wlan0
```

### Connect from PC/Android

Connect to the Wi-Fi network **RaspberryPiCam** and reach the RPi at **192.168.4.1**.

### How to disable the hotspot and restore normal Wi-Fi

```bash
sudo systemctl stop hostapd
sudo systemctl disable hostapd
sudo systemctl stop dnsmasq
sudo systemctl disable dnsmasq
sudo ip addr del 192.168.4.1/24 dev wlan0
```

Edit NetworkManager config and remove the `[keyfile]` section you added:

```bash
sudo nano /etc/NetworkManager/NetworkManager.conf
```

Remove these lines:

```
[keyfile]
unmanaged-devices=interface-name:wlan0
```

Then restart and reconnect:

```bash
sudo systemctl restart NetworkManager
sudo nmcli device wifi connect "YOUR_WIFI_NAME" password "YOUR_WIFI_PASSWORD"
```

---

## Option B: Ethernet Direct Connection (Router Mode)

This makes the Raspberry Pi act as a router over the Ethernet cable. The PC plugs in via Ethernet and gets an IP address automatically. Wi-Fi on the RPi continues to work normally.

**No configuration needed on the PC side — just plug in the cable.**

### Step 1: Set a static IP on eth0

```bash
sudo nmcli connection add type ethernet con-name eth0-router ifname eth0 \
  ipv4.addresses 192.168.4.1/24 \
  ipv4.method manual

sudo nmcli connection modify eth0-router connection.autoconnect yes
sudo nmcli connection up eth0-router
```

This gives the RPi the IP `192.168.4.1` on the Ethernet port.

### Step 2: Install dnsmasq

```bash
sudo apt update
sudo apt install dnsmasq
```

### Step 3: Configure dnsmasq for DHCP on eth0

Create a config file:

```bash
sudo nano /etc/dnsmasq.d/eth0-router.conf
```

Paste this:

```
interface=eth0
dhcp-range=192.168.4.50,192.168.4.150,255.255.255.0,24h
dhcp-option=3,192.168.4.1
dhcp-option=6,8.8.8.8
```

- `interface=eth0` — only serve DHCP on the Ethernet port (not Wi-Fi)
- `dhcp-range` — gives connected devices an IP between 192.168.4.50 and 192.168.4.150
- `dhcp-option=3` — tells the PC that 192.168.4.1 (the RPi) is the gateway
- `dhcp-option=6` — DNS server

### Step 4: Enable and restart dnsmasq

```bash
sudo systemctl enable dnsmasq
sudo systemctl restart dnsmasq
```

### Connect from PC

Plug an Ethernet cable between the RPi and your PC. The PC will automatically:
- Get an IP address like `192.168.4.x`
- See the RPi as the gateway at `192.168.4.1`

From the PC, reach the RPi at **192.168.4.1**.

### How to disable the Ethernet router mode

```bash
sudo nmcli connection delete eth0-router
sudo rm /etc/dnsmasq.d/eth0-router.conf
sudo systemctl restart dnsmasq
```

---

## Verify Connection (Both Options)

From your PC, test connectivity:

```bash
ping 192.168.4.1
```

Check status on the RPi:

```bash
nmcli device status
```
